IS_NUM: CASE
            WHEN TRY_CAST(NULLIF({$1}, '') AS float) IS NOT NULL THEN 1
            ELSE 0
        END

IS_DATE: |- 
          CASE
            WHEN NULLIF(LTRIM(RTRIM({$1})), '') IS NULL THEN 0
            WHEN (
                COALESCE(
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 112), /* YYYYMMDD  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 23),  /* YYYY-MM-DD  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 101), /* MM/DD/YYYY  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 1),   /* MM/DD/YY (2-digit year windowing)  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 110), /* MM-DD-YYYY  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 10),  /* MM-DD-YY (2-digit year windowing)  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 106), /* DD MMM YYYY  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 107), /* MMM dd, YYYY */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 126), /* ISO 8601 no TZ: YYYY-MM-DDTHH:MM:SS[.fff]  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 120), /* YYYY-MM-DD HH:MM:SS  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 121), /* YYYY-MM-DD HH:MM:SS.mmm  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 111), /* YYYY/MM/DD  */
                  TRY_CONVERT(datetime2, LTRIM(RTRIM({$1})), 102), /* YYYY.MM.DD  */
                  /* Normalize "YYYY-MM-DD HH:MM:SS SSSSSS" -> ISO 8601 with 'T' and '.' */
                  TRY_CONVERT(
                    datetime2,
                    CASE
                      WHEN LTRIM(RTRIM({$1})) LIKE
                           '[0-9][0-9][0-9][0-9]-[0-1][0-9]-[0-3][0-9] [0-2][0-9]:[0-5][0-9]:[0-5][0-9] [0-9]%'
                      THEN
                        /* Replace DT space (pos 11) with 'T', and the last space with '.' */
                        STUFF(
                          STUFF(LTRIM(RTRIM({$1})), 11, 1, 'T'),
                          LEN(LTRIM(RTRIM({$1}))) - CHARINDEX(' ', REVERSE(LTRIM(RTRIM({$1})))) + 1,
                          1,
                          '.'
                        )
                      ELSE LTRIM(RTRIM({$1}))
                    END,
                    126
                  )) BETWEEN '1800-01-01T00:00:00' AND '2200-12-31T23:59:59.9999999' )
              OR (  /* ISO 8601 with timezone: style 127 parsed as datetimeoffset, then cast */
                  CAST(TRY_CONVERT(datetimeoffset, LTRIM(RTRIM({$1})), 127) AS datetime2)
                  BETWEEN '1800-01-01T00:00:00' AND '2200-12-31T23:59:59.9999999' )
            THEN 1
            ELSE 0
          END
